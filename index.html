<html>
	<head>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>
		<h1>stampr</h1>
		
			<form>
				<div>
					<select name="stampvalue">
						<option value="47" selected>47&cent;</option>
						<option value="115">115&cent;</option>
					</select>
					<input id="cent-47" name="cent-47" value="2" type="number">
				</div>
				<div>
					<select name="stampvalue">
						<option value="47">47&cent;</option>
						<option value="115" selected>115&cent;</option>
					</select>
					<input id="cent-115" name="cent-115" value="4" type="number">
				</div>
				<div>
					<label for="target">Target Amount ($)</label>
					<input id="target" name="target" value="3.20" type="number">
				</div>
				<div>
					<input type="submit" value="Calculate">
				</div>
			</form>
		
		<div id="answer"></div>

		<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

		<script type="text/javascript">
			$(function() {

				// anything that needs to happen when DOM is loaded goes here

				
			});

			
			$("form").submit(newCalculate);


			function oldCalculate() {
				var USAStamps = $("form input[name='cent-47']").val();
				var GlobalStamps = $("form input[name='cent-115']").val();
				var target = $("form input[name='target']").val();

				var bestUSAStamps;
				var bestGlobalStamps;
				var bestValue = 0;

				for (var USATrial = 0; USATrial <= USAStamps; USATrial++) {
					for (var GlobalTrial = 0; GlobalTrial <= GlobalStamps; GlobalTrial++) {
						calculatedValue = (USATrial * .47) + (GlobalTrial * 1.15);
						
						if (calculatedValue >= target && (calculatedValue - target) < Math.abs(bestValue - target)) {
							bestValue = calculatedValue;
							bestUSAStamps = USATrial;
							bestGlobalStamps = GlobalTrial;

						}
					}
				}
				
				var answer = 'The best you can do is use ' + bestUSAStamps + ' USA stamps and ' + bestGlobalStamps + ' Global stamps for a total of $' + bestValue.toFixed(2) + '.';
				displayAnswer(answer);


				return false;


			}

			function newCalculate() {

				var stampsAvailable = [];
				var stampValues = [];

				var inputs = $("input[id|='cent']");
				inputs.each(function(index){
					stampsAvailable.push(parseInt($(this).val()));
					stampValues.push(parseInt($(this).prev("select").val()));
				});

				var target = parseFloat($("form input[name='target']").val())*100;

				var bestValue = 0;
				var calculatedValue = 0;
				var bestStamps = [];

				iterate(0, [], 0);
				
				var answer = 'The best you can do is use ';
				for (var i = 0; i < stampsAvailable.length; i++) {
					answer += bestStamps[i] + ' ' + stampValues[i] + 'Â¢ stamps';
					if (i < (stampsAvailable.length-1)) {
						answer += ", ";
					}
					else {
						answer += ".";
					}
				} 
				answer += "Your total will be $" + (bestValue/100).toFixed(2) + '.';
				displayAnswer(answer);


				return false;

				function iterate(stampNumber, prevStampQuantities, runningTotal = 0) {
					console.log("About to run the loop for stamp number " + stampNumber + " (" + stampValues[stampNumber] + ").");

					for (var i = 0; i <= stampsAvailable[stampNumber]; i++) {
						if (stampNumber == (stampsAvailable.length -1)) { // We are on the final stamp type
							console.log("Looks like there are no more stamp types. stampNumber is " + stampNumber);
							calculatedValue = runningTotal + (i * stampValues[stampNumber]);
							if (calculatedValue >= target && (calculatedValue - target) < Math.abs(bestValue - target)) {
								bestValue = calculatedValue;
								bestStamps = prevStampQuantities.slice();
								bestStamps.push(i);
							}
						}
						else {
							var intermediateValue = runningTotal + (i * stampValues[stampNumber]);
							console.log(prevStampQuantities);			

							prevStampQuantities.pop();
							prevStampQuantities.push(i);
							console.log("About to call iterate function, using prevStampQuantities of " + prevStampQuantities);

							iterate(stampNumber + 1, prevStampQuantities, intermediateValue);
						}
					}
				}

			}

			


			function displayAnswer(answer) {
				$("#answer").text(answer);
			}

// $("input[id|='cent']")


		</script>
	</body>
</html>